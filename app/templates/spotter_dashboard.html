{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Spotter Dashboard - Property Spotter</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="{% static 'css/spotter-dashboard.css' %}">
    
</head>
<body>
    <div class="dashboard-container">
        <nav class="main-navbar">
            <div class="navbar-left">
                <button id="sidebarCollapse" class="nav-toggle-btn">
                    <i class="fas fa-bars"></i>
                </button>
                <div class="brand">
                    <img src="{% static 'images/logo.png' %}" alt="Property Spotter" class="logo">
                </div>
            </div>
            <div class="navbar-center">
                <div class="search-container">
                    <i class="fas fa-search search-icon"></i>
                    <input type="text" placeholder="Search properties, leads..." class="search-input">
                </div>
            </div>
            <div class="navbar-right">
                <div class="nav-item">
                    <button class="notification-btn">
                        <i class="fas fa-bell"></i>
                        <span class="badge">3</span>
                    </button>
                </div>
                <div class="nav-item">
                    <button class="messages-btn">
                        <i class="fas fa-envelope"></i>
                        <span class="badge">5</span>
                    </button>
                </div>
                <div class="nav-item user-profile">
                    <img src="{% static 'images/default-avatar.png' %}" alt="Profile" class="profile-img">
                    <div class="user-info">
                        <span class="user-name">{{ user.full_name }}</span>
                        <span class="user-role">Spotter</span>
                    </div>
                    <i class="fas fa-chevron-down"></i>
                </div>
            </div>
        </nav>
        <!-- Sidebar -->
        <nav id="sidebar" class="sidebar">
            

            <div class="sidebar-user">
                <img src="{% static 'images/default-avatar.png' %}" alt="User Avatar" class="user-avatar">
                <div class="user-info">
                    <h6>{{ user.full_name }}</h6>
                    <span class="badge bg-primary">Spotter</span>
                </div>
            </div>

            <ul class="sidebar-nav">
                <li class="nav-item">
                    <a href="#" class="nav-link active" data-section="dashboard">
                        <i class="fas fa-tachometer-alt"></i>
                        <span>Dashboard</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="#" class="nav-link" data-section="leads">
                        <i class="fas fa-lightbulb"></i>
                        <span>My Leads</span>
                        <span class="badge bg-danger">3</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="#" class="nav-link" data-section="sales">
                        <i class="fas fa-chart-line"></i>
                        <span>My Sales</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="#" class="nav-link" data-section="properties">
                        <i class="fas fa-home"></i>
                        <span>Market Properties</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="#" class="nav-link" data-section="profile">
                        <i class="fas fa-user"></i>
                        <span>Profile</span>
                    </a>
                </li>
            </ul>

            <div class="sidebar-footer">
                <a href="/logout" class="btn btn-logout">
                    <i class="fas fa-sign-out-alt"></i>
                    <span>Logout</span>
                </a>
            </div>
        </nav>

        <!-- Main Content -->
        <div class="main-content">
            <!-- Top Navigation -->
            

            <!-- Dashboard Content -->
            <div class="content-wrapper">
                <!-- Stats Cards -->
                <div class="row stats-cards">
                    <div class="col-md-3">
                        <div class="stats-card">
                            <div class="stats-icon bg-primary">
                                <i class="fas fa-lightbulb"></i>
                            </div>
                            <div class="stats-info">
                                <h5>Total Leads</h5>
                                <h3>24</h3>
                                <p class="trend positive">
                                    <i class="fas fa-arrow-up"></i> 12% from last month
                                </p>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="stats-card">
                            <div class="stats-icon bg-success">
                                <i class="fas fa-check-circle"></i>
                            </div>
                            <div class="stats-info">
                                <h5>Converted Sales</h5>
                                <h3>8</h3>
                                <p class="trend positive">
                                    <i class="fas fa-arrow-up"></i> 5% from last month
                                </p>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="stats-card">
                            <div class="stats-icon bg-warning">
                                <i class="fas fa-coins"></i>
                            </div>
                            <div class="stats-info">
                                <h5>Commission Earned</h5>
                                <h3>R 45,200</h3>
                                <p class="trend positive">
                                    <i class="fas fa-arrow-up"></i> 8% from last month
                                </p>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="stats-card">
                            <div class="stats-icon bg-info">
                                <i class="fas fa-clock"></i>
                            </div>
                            <div class="stats-info">
                                <h5>Pending Leads</h5>
                                <h3>12</h3>
                                <p class="trend negative">
                                    <i class="fas fa-arrow-down"></i> 3% from last month
                                </p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Recent Activity -->
                <div class="row mt-4">
                    <div class="col-md-8">
                        <div class="card">
                            <div class="card-header">
                                <h5 class="card-title">Recent Leads</h5>
                            </div>
                            <div class="card-body">
                                <div class="activity-list">
                                    <!-- Activity Items -->
                                    <div class="activity-item">
                                        <div class="activity-icon bg-success">
                                            <i class="fas fa-check"></i>
                                        </div>
                                        <div class="activity-content">
                                            <h6>New Lead Converted</h6>
                                            <p>123 Main Street property successfully sold</p>
                                            <small class="text-muted">2 hours ago</small>
                                        </div>
                                        <div class="activity-status">
                                            <span class="badge bg-success">Completed</span>
                                        </div>
                                    </div>
                                    <!-- More activity items... -->
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="card">
                            <div class="card-header">
                                <h5 class="card-title">Performance Overview</h5>
                            </div>
                            <div class="card-body">
                                <canvas id="performanceChart"></canvas>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="{% static 'js/spotter-dashboard.js' %}"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
    // Sidebar Toggle
    const sidebar = document.getElementById('sidebar');
    const sidebarCollapse = document.getElementById('sidebarCollapse');
    const mainContent = document.querySelector('.main-content');

    sidebarCollapse.addEventListener('click', function() {
        sidebar.classList.toggle('collapsed');
        // Store the state in localStorage
        localStorage.setItem('sidebarCollapsed', sidebar.classList.contains('collapsed'));
    });

    // Restore sidebar state from localStorage
    if (localStorage.getItem('sidebarCollapsed') === 'true') {
        sidebar.classList.add('collapsed');
    }

    // Handle navigation clicks
    const navLinks = document.querySelectorAll('.nav-link');
    navLinks.forEach(link => {
        link.addEventListener('click', function(e) {
            // Remove active class from all links
            navLinks.forEach(l => l.classList.remove('active'));
            // Add active class to clicked link
            this.classList.add('active');

            // Update page title
            const pageTitle = document.querySelector('.page-title');
            if (pageTitle) {
                const linkText = this.querySelector('span')?.textContent || 'Dashboard';
                pageTitle.textContent = linkText + ' Overview';
            }

            // On mobile, close sidebar after navigation
            if (window.innerWidth <= 992) {
                sidebar.classList.remove('show');
            }
        });
    });

    // Mobile sidebar toggle
    if (window.innerWidth <= 992) {
        document.addEventListener('click', function(e) {
            if (!sidebar.contains(e.target) && !sidebarCollapse.contains(e.target)) {
                sidebar.classList.remove('show');
            }
        });

        sidebarCollapse.addEventListener('click', function(e) {
            e.stopPropagation();
            sidebar.classList.toggle('show');
        });
    }

    // Performance Chart
    const setupPerformanceChart = () => {
        const ctx = document.getElementById('performanceChart');
        if (ctx) {
            return new Chart(ctx, {
                type: 'line',
                data: {
                    labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun'],
                    datasets: [{
                        label: 'Leads',
                        data: [12, 19, 15, 17, 14, 24],
                        borderColor: '#1D4ED8',
                        backgroundColor: 'rgba(29, 78, 216, 0.1)',
                        tension: 0.4,
                        fill: true
                    }, {
                        label: 'Conversions',
                        data: [4, 7, 5, 6, 5, 8],
                        borderColor: '#10B981',
                        backgroundColor: 'rgba(16, 185, 129, 0.1)',
                        tension: 0.4,
                        fill: true
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: {
                                usePointStyle: true,
                                padding: 20
                            }
                        },
                        tooltip: {
                            mode: 'index',
                            intersect: false,
                            backgroundColor: 'rgba(0, 0, 0, 0.8)',
                            padding: 12,
                            borderColor: 'rgba(255, 255, 255, 0.1)',
                            borderWidth: 1
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            grid: {
                                color: 'rgba(0, 0, 0, 0.05)'
                            }
                        },
                        x: {
                            grid: {
                                display: false
                            }
                        }
                    },
                    interaction: {
                        intersect: false,
                        mode: 'index'
                    }
                }
            });
        }
    };

    let performanceChart = setupPerformanceChart();

    // Handle window resize for chart responsiveness
    window.addEventListener('resize', function() {
        if (performanceChart) {
            performanceChart.destroy();
            performanceChart = setupPerformanceChart();
        }
    });

    // Notifications System
    const setupNotifications = () => {
        const notificationsBtn = document.querySelector('.notifications .nav-link');
        if (notificationsBtn) {
            const notifications = [
                { title: 'New Lead', message: 'You have a new property lead', time: '2 mins ago' },
                { title: 'Commission Paid', message: 'Commission for 123 Main St has been processed', time: '1 hour ago' },
                { title: 'Lead Update', message: 'Status updated for 456 Park Ave lead', time: '3 hours ago' }
            ];

            // Create notifications dropdown
            const createNotificationsDropdown = () => {
                const dropdown = document.createElement('div');
                dropdown.className = 'notifications-dropdown';
                dropdown.innerHTML = `
                    <div class="notifications-header">
                        <h6>Notifications</h6>
                        <button class="mark-all-read">Mark all as read</button>
                    </div>
                    <div class="notifications-list">
                        ${notifications.map(notif => `
                            <div class="notification-item">
                                <div class="notification-icon">
                                    <i class="fas fa-bell"></i>
                                </div>
                                <div class="notification-content">
                                    <h6>${notif.title}</h6>
                                    <p>${notif.message}</p>
                                    <small>${notif.time}</small>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                    <div class="notifications-footer">
                        <a href="#">View all notifications</a>
                    </div>
                `;
                return dropdown;
            };

            let activeDropdown = null;

            notificationsBtn.addEventListener('click', function(e) {
                e.preventDefault();
                e.stopPropagation();

                if (activeDropdown) {
                    activeDropdown.remove();
                    activeDropdown = null;
                } else {
                    activeDropdown = createNotificationsDropdown();
                    this.parentNode.appendChild(activeDropdown);
                }
            });

            // Close dropdown when clicking outside
            document.addEventListener('click', function(e) {
                if (activeDropdown && !activeDropdown.contains(e.target)) {
                    activeDropdown.remove();
                    activeDropdown = null;
                }
            });
        }
    };

    setupNotifications();

    // Stats Cards Animation
    const statsCards = document.querySelectorAll('.stats-card');
    statsCards.forEach(card => {
        card.addEventListener('mouseenter', function() {
            this.style.transform = 'translateY(-5px)';
            this.style.transition = 'all 0.3s ease';
            this.style.boxShadow = '0 4px 12px rgba(0,0,0,0.1)';
        });

        card.addEventListener('mouseleave', function() {
            this.style.transform = 'translateY(0)';
            this.style.boxShadow = '0 2px 4px rgba(0,0,0,0.05)';
        });
    });

    // Activity Items Interaction
    const activityItems = document.querySelectorAll('.activity-item');
    activityItems.forEach(item => {
        item.addEventListener('click', function() {
            this.classList.add('activity-highlight');
            setTimeout(() => {
                this.classList.remove('activity-highlight');
            }, 200);
        });
    });

    // Button Loading States
    const buttons = document.querySelectorAll('button:not(#sidebarCollapse)');
    buttons.forEach(button => {
        button.addEventListener('click', function() {
            const originalContent = this.innerHTML;
            if (!this.classList.contains('loading')) {
                this.classList.add('loading');
                this.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Loading...';
                
                // Simulate loading state
                setTimeout(() => {
                    this.classList.remove('loading');
                    this.innerHTML = originalContent;
                }, 1000);
            }
        });
    });

    // Initialize tooltips if using Bootstrap
    if (typeof bootstrap !== 'undefined') {
        const tooltips = document.querySelectorAll('[data-bs-toggle="tooltip"]');
        tooltips.forEach(tooltip => {
            new bootstrap.Tooltip(tooltip);
        });
    }

    // Handle form submissions with loading states
    const forms = document.querySelectorAll('form');
    forms.forEach(form => {
        form.addEventListener('submit', function(e) {
            const submitButton = this.querySelector('button[type="submit"]');
            if (submitButton && !submitButton.classList.contains('loading')) {
                submitButton.classList.add('loading');
                submitButton.disabled = true;
            }
        });
    });
});
    </script>
</body>
</html>